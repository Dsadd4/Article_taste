# 推荐系统安装说明

## 环境要求

推荐系统需要以下Python包：

### 基础依赖（已包含在requirements.txt中）
- numpy（用于向量计算）

### 当前状态

- **方法A（关键词匹配）**：✅ 已实现，无需额外依赖
- **方法B（语义相似度）**：✅ 已实现，使用轻量级本地模型（约40MB）
- **方法C（AI智能推荐）**：✅ 已实现，使用Qwen API

## 方法B：语义相似度推荐（已实现）

**实现方案：**
- 使用轻量级embedding模型：`paraphrase-MiniLM-L3-v2`（约40MB）
- 备用模型：`all-MiniLM-L6-v2`（约80MB）
- 本地运行，无需API调用
- 计算收藏夹文章与新文章的语义相似度

**安装依赖：**
```bash
conda activate scrath_new
pip install sentence-transformers
```

**首次使用：**
- 首次运行时会自动下载模型（约40MB）
- 下载完成后会缓存到本地，后续使用无需下载
- 模型路径：`~/.cache/torch/sentence_transformers/`

**性能：**
- 模型加载：约1-2秒（首次下载后）
- 向量化速度：约100-200篇文章/秒
- 内存占用：约200-300MB

### 方法C：AI智能推荐（待实现）

**实现方案：**
1. 直接调用Qwen API分析收藏夹（无需LangChain）
2. 理解研究兴趣和主题
3. 结合语义匹配和关键词匹配进行智能推荐

**无需LangChain依赖**，直接使用HTTP请求调用API即可。

## 使用说明

### 当前可用方法

**方法A（关键词匹配）**：✅ 已实现并可用
- 基于收藏夹关键词匹配
- 速度快，无需额外依赖
- 推荐质量：中等

**方法B（语义相似度）**：⏳ 待实现
- 当前会自动降级到方法A
- 后续将直接调用API实现

**方法C（AI智能推荐）**：⏳ 待实现
- 当前会自动降级到方法A
- 后续将直接调用API实现

### 方法选择逻辑

系统会根据收藏夹数量自动选择方法：
- **收藏 < 3篇**：使用方法A（关键词匹配）
- **收藏 3-9篇**：使用方法B（语义相似度）- 当前降级到方法A
- **收藏 ≥ 10篇**：使用方法C（AI智能推荐）- 当前降级到方法A

### 手动选择方法

也可以通过按钮手动选择：
- **智能推荐**：自动选择最适合的方法（当前都使用方法A）
- **推荐（关键词）**：强制使用关键词匹配 ✅
- **推荐（语义）**：强制使用语义相似度（当前降级到方法A）
- **推荐（AI）**：强制使用AI智能推荐（当前降级到方法A）

### 通过AI助手推荐

在聊天框中输入：
- "推荐"
- "推荐文章"
- "相关文章"

AI助手会自动触发推荐功能。

## 故障排除

### 问题1：方法B/C返回空结果或降级到方法A

**当前状态：**
- 方法B和C暂未实现，会自动降级到方法A
- 这是正常行为，不影响使用

**如果方法A也返回空结果：**
1. 确保收藏夹中有文章
2. 确保缓存中有文章数据（先点击期刊按钮获取数据）

## 性能说明

- **方法A（关键词）**：最快，几乎瞬时完成 ✅
- **方法B（语义）**：待实现
- **方法C（AI）**：待实现

## 推荐质量

- **方法A**：基于关键词匹配，可能遗漏语义相关但关键词不同的文章 ✅
- **方法B**：待实现，将基于语义相似度，能发现更多相关文章
- **方法C**：待实现，将结合LLM分析和语义匹配，推荐最精准

